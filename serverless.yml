# Welcome to Serverless!
#
# This file is the main config file for your service.
# It's very minimal at this point and uses default values.
# You can always add more config options for more control.
# We've included some commented out config examples here.
# Just uncomment any of them to get that config option.
#
# For full config options, check the docs:
#    docs.serverless.com
#
# Happy Coding!

# service: TerralanesAPI
# app: TerralanesAPI-dev
# org: terralanes

org: terralanes
app: terralanes-backend
service: terralanes-api

# You can pin your service to only deploy with a specific Serverless version
# Check out our docs for more details
# frameworkVersion: "=X.X.X" test

provider:
  name: aws
  runtime: nodejs12.x
  vpc:
    securityGroupIds:
      - sg-012e7222a5f8ac6cc
    subnetIds:
      - subnet-03086cdd9e1e48134
      - subnet-0243c1302f458775f
  profile: default
  region: us-east-1
  stage: dev
  environment:
    DB_URL: ${param:DB_URL, env:DB_URL}
    DB_DATABASE: ${param:DB_DATABASE, env:DB_DATABASE}
    DB_PASSWORD: ${param:DB_PASSWORD, env:DB_PASSWORD}
    DB_USERNAME: ${param:DB_USERNAME, env:DB_USERNAME}
    SEARCH_URL: ${param:SEARCH_URL, env:SEARCH_URL}
    SEARCH_USER: ${param:SEARCH_USER, env:SEARCH_USER}
    SEARCH_PASSWORD: ${param:SEARCH_PASSWORD, env:SEARCH_PASSWORD}
    REACT_APP_MAPBOX_KEY: ${param:REACT_APP_MAPBOX_KEY, env:REACT_APP_MAPBOX_KEY}
    NODE_ENV: ${param:NODE_ENV, env:NODE_ENV}
    ORIGIN_URL: ${param:ORIGIN_URL, env:ORIGIN_URL}

plugins:
  - serverless-offline
  # - serverless-vpc-discovery
  - serverless-dependson-plugin

custom:
  dependsOn:
    enabled: true
    chains: 20
#   vpcDiscovery:
#     vpcName: aurora-vpc
#     subnets:
#       - tagKey: Name
#         tagValues:
#           - aurora-public-subnet-1
#       - tagKey: Name
#         tagValues:
#           - aurora-sub-2
#     securityGroups:
#       - names:
#         - aurora-sg1

package:
  individually: false

functions:

# Search
  search:
    handler:
      ./handlers/search.search
    events:
        - http:
            path: api/search
            method: get
            cors: true
  searchLedger:
    handler:
      ./handlers/search.searchLedger
    events:
        - http:
            path: api/ledger/search
            method: get
            cors: true
  searchUsersInBrokerage:
    handler:
      ./handlers/search.searchUsersInBrokerage
    events:
        - http:
            path: api/search/users
            method: get
            cors: true
  searchContacts:
    handler:
      ./handlers/search.searchContacts
    events:
        - http:
            path: api/search/contacts
            method: get
            cors: true

# Ledger
  getLedger:
    handler:
      ./handlers/ledger.getLedger
    events:
        - http:
            path: api/ledger/{id}
            method: get
            cors: true
  writeMessage:
    handler:
      ./handlers/ledger.writeMessage
    events:
        - http:
            path: api/ledger
            method: post
            cors: true
  updateMessage:
    handler:
      ./handlers/ledger.updateMessage
    events:
        - http:
            path: api/ledger/message/{id}
            method: put
            cors: true
        - http:
            path: api/ledger/message/{id}
            method: delete
            cors: true

# User
  getUser:
    handler:
      ./handlers/user.getUser
    events:
        - http:
            path: api/user
            method: get
            cors: true
  deleteUser:
    handler:
      ./handlers/user.deleteUser
    events:
        - http:
            path: api/user/{userId}
            method: delete
            cors: true
  getUserById:
    handler:
      ./handlers/user.getUserById
    events:
        - http:
            path: api/user/{userId}
            method: get
            cors: true
  getTeams:
    handler:
      ./handlers/user.getTeams
    events:
        - http:
            path: api/user/teams
            method: get
            cors: true
  createProfile:
    handler:
      ./handlers/user.createProfile
    events:
        - http:
            path: api/user
            method: post
            cors: true
  updateProfile:
    handler:
      ./handlers/user.updateProfile
    events:
        - http:
            path: api/user
            method: put
            cors: true
  getTopCustomersForUser:
    handler:
      ./handlers/user.getTopCustomersForUser
    events:
        - http:
            path: api/customer/top/{userId}
            method: get
            cors: true
  getTopLanesForUser:
    handler:
      ./handlers/user.getTopLanesForUser
    events:
        - http:
            path: api/lane/top/{userId}
            method: get
            cors: true

# Customer
  updateCustomer:
    handler:
      ./handlers/customer.updateCustomer
    events:
        - http:
            path: api/customer/{customerId}
            method: put
            cors: true
  getCustomer:
    handler:
      ./handlers/customer.getCustomer
    events:
        - http:
            path: api/customer/{customerId}
            method: get
            cors: true
  getLanesForCustomer:
    handler:
      ./handlers/customer.getLanesForCustomer
    events:
        - http:
            path: api/lanes/customer/{customerId}
            method: get
            cors: true
  getLocationsForCustomer:
    handler:
      ./handlers/customer.getLocationsForCustomer
    events:
        - http:
            path: api/customer/{customerId}/locations
            method: get
            cors: true
  getTeammatesForCustomer:
    handler:
      ./handlers/customer.getTeammatesForCustomer
    events:
        - http:
            path: api/customer/{customerId}/teammates
            method: get
            cors: true
  addTeammateToCustomer:
    handler:
      ./handlers/customer.addTeammateToCustomer
    events:
        - http:
            path: api/customer/teammates
            method: post
            cors: true
  deleteTeammateFromCustomer:
    handler:
      ./handlers/customer.deleteTeammateFromCustomer
    events:
        - http:
            path: api/customer/teammates
            method: delete
            cors: true

# Lane
  getLanesByUser:
    handler:
      ./handlers/lane.getLanesByUser
    events:
        - http:
            path: api/lane/user/{id}
            method: get
            cors: true
  getLaneById:
    handler:
      ./handlers/lane.getLaneById
    events:
        - http:
            path: api/lane/{laneId}
            method: get
            cors: true
  updateLane:
    handler:
      ./handlers/lane.updateLane
    events:
        - http:
            path: api/lane/{laneId}
            method: put
            cors: true
  getMarketFeedback:
    handler:
      ./handlers/lane.getMarketFeedback
    events:
        - http:
            path: api/lane/{laneId}/feedback
            method: get
            cors: true
  addMarketFeedback:
    handler:
      ./handlers/lane.addMarketFeedback
    events:
        - http:
            path: api/lane/{laneId}/feedback
            method: post
            cors: true
  deleteMarketFeedback:
    handler:
      ./handlers/lane.deleteMarketFeedback
    events:
        - http:
            path: api/lane/{laneId}/feedback/{feedbackId}
            method: delete
            cors: true
  getTeammatesForLane:
    handler:
      ./handlers/lane.getTeammatesForLane
    events:
        - http:
            path: api/lane/{laneId}/teammates
            method: get
            cors: true
  addTeammatetoLane:
    handler:
      ./handlers/lane.addTeammateToLane
    events:
        - http:
            path: api/lane/teammates
            method: post
            cors: true
  deleteTeammateFromLane:
    handler:
      ./handlers/lane.deleteTeammateFromLane
    events:
        - http:
            path: api/lane/teammates
            method: delete
            cors: true
  getTopCarriers:
    handler:
      ./handlers/lane.getTopCarriers
    events:
        - http:
            path: api/lane/{laneId}/carriers
            method: get
            cors: true

  # Team
  addTeam:
    handler:
      ./handlers/team.addTeam
    events:
        - http:
            path: api/team
            method: post
            cors: true
  editTeam:
    handler:
      ./handlers/team.editTeam
    events:
        - http:
            path: api/team/{teamId}
            method: put
            cors: true
  deleteTeam:
    handler:
      ./handlers/team.deleteTeam
    events:
        - http:
            path: api/team/{teamId}
            method: delete
            cors: true
  getTeamById: 
    handler:
      ./handlers/team.getTeamById
    events:
        - http:
            path: api/team/{teamId}
            method: get
            cors: true
  getLanesForTeam:
    handler:
      ./handlers/team.getLanesForTeam
    events:
        - http:
            path: api/team/{teamId}/lanes
            method: get
            cors: true
  getTeammatesForTeam:
    handler:
      ./handlers/team.getTeammatesForTeam
    events:
        - http:
            path: api/team/{teamId}/teammates
            method: get
            cors: true
  removeTeammate:
    handler:
      ./handlers/team.removeTeammate
    events:
        - http:
            path: api/team/teammate/{userId}
            method: delete
            cors: true
  addTeammate:
    handler:
      ./handlers/team.addTeammate
    events:
        - http:
            path: api/team/teammate
            method: put
            cors: true

  # Location
  getLocationById:
    handler:
      ./handlers/location.getLocationById
    events:
        - http:
            path: api/location/{locationId}
            method: get
            cors: true
  editLocation:
    handler:
      ./handlers/location.editLocation
    events:
        - http:
            path: api/location
            method: put
            cors: true
  getLanesForLocation:
    handler:
      ./handlers/location.getLanesForLocation
    events:
        - http:
            path: api/location/{locationId}/lanes
            method: get
            cors: true
  getTeammatesForLocation:
    handler:
      ./handlers/location.getTeammatesForLocation
    events:
        - http:
            path: api/location/{locationId}/teammates
            method: get
            cors: true

  addTeammatetoLocation:
    handler:
      ./handlers/location.addTeammateToLocation
    events:
        - http:
            path: api/location/teammates
            method: post
            cors: true
  deleteTeammateFromLocation:
    handler:
      ./handlers/location.deleteTeammateFromLocation
    events:
        - http:
            path: api/location/teammates
            method: delete
            cors: true
  
  # Brokerage
  getBrokerage:
    handler:
      ./handlers/brokerage.getBrokerage
    events:
        - http:
            path: api/brokerage/{brokerageId}
            method: get
            cors: true
  getLanesForBrokerage:
    handler:
      ./handlers/brokerage.getLanesForBrokerage
    events:
        - http:
            path: api/brokerage/{brokerageId}/lanes
            method: get
            cors: true
  editBrokerage:
    handler:
      ./handlers/brokerage.editBrokerage
    events:
        - http:
            path: api/brokerage
            method: put
            cors: true

  # Tag
  getTags:
    handler:
      ./handlers/tag.getTags
    events:
        - http:
            path: api/tag/{itemId}
            method: get
            cors: true
  addTag:
    handler:
      ./handlers/tag.addTag
    events:
        - http:
            path: api/tag/{itemId}
            method: post
            cors: true
  deleteTag:
    handler:
      ./handlers/tag.deleteTag
    events:
        - http:
            path: api/tag
            method: delete
            cors: true
  # Contact
  getContacts:
    handler:
      ./handlers/contact.getContacts
    events:
        - http:
            path: api/contact/{itemId}
            method: get
            cors: true
  addContact:
    handler:
      ./handlers/contact.addContact
    events:
        - http:
            path: api/contact/{itemId}
            method: post
            cors: true
  editContact:
    handler:
      ./handlers/contact.editContact
    events:
        - http:
            path: api/contact/
            method: put
            cors: true
  deleteContact:
    handler:
      ./handlers/contact.deleteContact
    events:
        - http:
            path: api/contact
            method: delete
            cors: true

  # CSV Upload
  ascendLoadsUpload:
    handler:
      ./handlers/upload.ascendLoadsUpload
    events:
        - http:
            path: api/upload/ascend
            method: post
            cors: true
  ascendCustomerUpload:
    handler:
      ./handlers/upload.ascendCustomerUpload
    events:
        - http:
            path: api/upload/ascend/customers
            method: post
            cors: true
    
  # Onboarding
  getTeamsForBrokerage:
    handler:
      ./handlers/onboarding.getTeamsForBrokerage
    events:
        - http:
            path: api/onboarding/teams
            method: get
            cors: true
  getCustomersForBrokerage:
    handler:
      ./handlers/onboarding.getCustomersForBrokerage
    events:
        - http:
            path: api/onboarding/customers
            method: get
            cors: true
  joinTeam:
    handler:
      ./handlers/onboarding.joinTeam
    events:
        - http:
            path: api/onboarding/team/{teamId}
            method: post
            cors: true